<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Naveen J" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Naveen J" /> <title> DLL Injection on one of the biggest Business Automation application - Naveen J </title> <link rel="alternate" href="http://localhost:4000/RCE-DLL-Hijacking/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/RCE-DLL-Hijacking/" /> <meta name="description" content="Remote Code Execution via DLL Hijacking on a top 5 business automation product." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="DLL Injection on one of the biggest Business Automation application | Naveen J" /> <meta property="og:title" content="DLL Injection on one of the biggest Business Automation application | Naveen J" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/RCE-DLL-Hijacking/" /> <meta property="og:description" content="Remote Code Execution via DLL Hijacking on a top 5 business automation product." /> <meta property="og:image" content="" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="DLL Injection on one of the biggest Business Automation application | thevillagehackr" /> <meta name="twitter:url" content="http://localhost:4000/RCE-DLL-Hijacking/" /> <meta name="twitter:site" content="@thevillagehackr" /> <meta name="twitter:creator" content="@thevillagehackr" /> <meta name="twitter:description" content="Remote Code Execution via DLL Hijacking on a top 5 business automation product." /> <meta name="twitter:image" content="" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Naveen J" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/blog/">Blog</a><a class="menu-link" href="/about/">About</a><a class="menu-link" href="/projects/">Projects</a><!-- <a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a>---> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#dll-hijacking">DLL HIJACKING</a>, <a class="tag" href="/tags/#rce">RCE</a>, <a class="tag" href="/tags/#product-security">PRODUCT SECURITY</a> </span> </div> <h1 class="header-title" itemprop="headline">DLL Injection on one of the biggest Business Automation application</h1> <div class="post-meta"> <time datetime="2022-12-15T12:00:00+00:00" itemprop="datePublished"> Dec 15, 2022 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Naveen J</span> </span> <time hidden datetime="" itemprop="dateModified"> Dec 15, 2022 </time> <span hidden itemprop="publisher" itemtype="Person">Naveen J</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h2 id="dll-hijacking">DLL Hijacking</h2> <p>DLL hijacking is a method of injecting malicious code into an application by exploiting the way some Windows applications search and load Dynamic Link Libraries (DLL).</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h2 id="dll-hijacking"> <a href="#dll-hijacking" class="anchor-head"></a> DLL Hijacking </h2> <p>DLL hijacking is a method of injecting malicious code into an application by exploiting the way some Windows applications search and load Dynamic Link Libraries (DLL).</p> <p>Only Microsoft operating systems are susceptible to DLL hijacks.</p> <p>By replacing a required DLL file with an infected version and placing it within the search parameters of an application, the infected file will be called upon when the application loads, activating its malicious operations.</p> <p>For a DLL hijack to be successful, a victim needs to load an infected DLL file from the same directory as the targeted application.</p> <p>If applications that are automatically loaded upon startup are compromised with a tainted DLL file, cybercriminals will be granted access to the infected computer whenever it loads.</p> <p>DLL hijacking is not an innovative cyberattack method. It has been in circulation among cybercriminals since Windows 2000 launched.</p> <h2 id="what-are-dll-files"> <a href="#what-are-dll-files" class="anchor-head"></a> What are DLL Files? </h2> <p>DLL files, or Dynamic Link Library files, contain the resources an application needs to run successfully. These could include images and a library of executable functions.</p> <p>DLL files cannot be opened by end-users, they can only be opened by their associated application, which usually happens when the application starts up.</p> <p>Windows systems require DLL files to understand how to use their resources, the host computer memory, and hard drive space most efficiently.</p> <p>DLL files usually end with a .dll extension, but some could end in .drv, .drov and even .exe.</p> <p>A single DLL file could run multiple programs, so multiple programs could potentially be comprised in a DLL hijacking attack.</p> <h2 id="how-does-dll-hijacking-work"> <a href="#how-does-dll-hijacking-work" class="anchor-head"></a> How Does DLL Hijacking Work? </h2> <p>For a DLL hijacking attack to be successful, a Windows application needs to be tricked into loading an infected DLL file instead of the legitimate DLL.</p> <p>By exploiting the publicized DLL search order of Microsoft applications, this trickery is relatively simple to execute.</p> <p>The standard DLL search order of Microsoft applications depends upon whether safe DLL search is enabled.</p> <p>When safe DLL search mode is enabled, applications search for required DLL files in the following order:</p> <ol> <li>The directory from which the application is loaded.</li> <li>The system directory.</li> <li>The 16-bit system directory.</li> <li>The Windows directory.</li> <li>The current directory.</li> <li>The directories that are listed in the PATH environment variable.</li> </ol> <p>When safe DLL search mode is disabled, the search order is as follows:</p> <ol> <li>The directory from which the application is loaded.</li> <li>The current directory.</li> <li>The system directory.</li> <li>The 16-bit directory.</li> <li>The Windows directory</li> <li>The directory listed in the PATH environment variable.</li> </ol> <p>The difference between the two search modes is the order in which the user’s current directory is searched, it’s slightly elevated in the hierarchy when safe search is disabled.</p> <p>When safe search is disabled, the user’s current directory is slightly elevated in the search order.</p> <p>Windows applications will default to any one of the above DLL search protocols if an application does not specify the full path of associated DLL files.</p> <p>This is the exploit that makes DLL hacking possible.</p> <p><strong>For example</strong>, if a Windows application requires a DLL file located in the system directory C:\Windows\System32 but there are no instructions in its code to search in this explicit location, the application will work through a DLL search order to locate the file.</p> <p>Regardless of whether or not safe search is enabled, the directory from which the application is launched is the first location that is searched.</p> <p>If a cybercriminal deposits an infected DLL file in this location, the application will open it instead of the original because its location was searched first, before the system directory.</p> <p>This technique is also known as DLL search order hijacking.</p> <h2 id="exploitation"> <a href="#exploitation" class="anchor-head"></a> Exploitation </h2> <h2 id="enumerate-the-process"> <a href="#enumerate-the-process" class="anchor-head"></a> Enumerate the process </h2> <p>Enumerating the process and it’s dll files using the process monitor tool.</p> <p><img src="1.process.png" alt="process_img" /></p> <p>Post enummerating the process the malicious dll file which opens the calculator application in windows has been created with the help of metasploit framework.</p> <h2 id="generate-payload-to-check-blind-rce-by-popping-an-calculator"> <a href="#generate-payload-to-check-blind-rce-by-popping-an-calculator" class="anchor-head"></a> Generate Payload to check blind RCE by popping an calculator </h2> <p>Generating the payload using metasploit to open calculator to check whether the application is loading the malicious dll file or not.</p> <p><img src="2.payload_gen.png" alt="Calc_payload" title="Calculator Payload" /></p> <h2 id="placing-malicious-dll-file-in-the-application-directory"> <a href="#placing-malicious-dll-file-in-the-application-directory" class="anchor-head"></a> Placing Malicious DLL file in the application directory </h2> <p><img src="3.dll_location.png" alt="Placing_malicious_file" /></p> <p>The genetrated payload is placed in the respective application directory based on the process monitor information.</p> <h2 id="rce-calculator-pop-up"> <a href="#rce-calculator-pop-up" class="anchor-head"></a> RCE (Calculator Pop up) </h2> <h3 id="process-monitor"> <a href="#process-monitor" class="anchor-head"></a> Process Monitor </h3> <p><img src="4.dll_accessed.png" alt="proc_mon" /></p> <p>Once the application starts running the dll file has been accessed by the application and the calculator application is opened.</p> <h3 id="calculator"> <a href="#calculator" class="anchor-head"></a> Calculator </h3> <p><img src="5.rce.png" alt="calc_popup" /></p> <h2 id="reverse-shell"> <a href="#reverse-shell" class="anchor-head"></a> Reverse Shell </h2> <h3 id="generating-payload-for-reverse-shell"> <a href="#generating-payload-for-reverse-shell" class="anchor-head"></a> Generating payload for Reverse shell </h3> <p>Since we had the successful exploitation of RCE via opening the calculator application, let’s escalate this to get the remote shell to the targeted machine.</p> <p><img src="6.1.rce.png" alt="reverseshell_payload" /></p> <p>The reverse shell has been generated with the help of metasploit framework and the malicious dll has been placed in the respective application directoty for exploitation.</p> <h3 id="process-monitor-1"> <a href="#process-monitor-1" class="anchor-head"></a> Process monitor </h3> <p>Checkinf whether the application validates the dll file or not. <img src="6.2.rce.png" alt="proc_mon" /></p> <h3 id="windows-reverse-shell-via-meterpreter"> <a href="#windows-reverse-shell-via-meterpreter" class="anchor-head"></a> Windows reverse shell via meterpreter </h3> <p><img src="6.3.rce.png" alt="reverse_tcp_shell" /> The application is nto validating the dll files, once the application is started then the metepreter shell connection is received from the targeted windows machine.</p> <h2 id="how-to-prevent-dll-hijacking"> <a href="#how-to-prevent-dll-hijacking" class="anchor-head"></a> How to Prevent DLL Hijacking </h2> <ul> <li>The first line of defense needs to be established by software developers. Developers need to follow secure coding practices and specify the exact location of all associated DLL files to prevent Windows from defaulting to its DLL search path protocol.</li> <li>The application should not load the untruested dll files.</li> <li> <p>Adherence to secure coding practices can never be guaranteed, so organizations should implement the following additional defenses:</p> <ul> <li>Keep antivirus software up-to-date.</li> <li>Educate staff about phishing and social engineering warning signs.</li> <li>Strengthen your security posture by continuously monitoring your attack surface.</li> <li>Implement a vendor risk management solution.</li> </ul> </li> </ul> <p>Thank you for reading.</p> <p>Follow me on Twitter : <a href="https://twitter.com/thevillagehackr">thevillagehacker</a></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/IDOR/" > <div class="nav-arrow">Previous</div> <span class="post-title">IDOR leads to Takeover other user's linked bank accounts</span> </a> <a class="post-nav-item post-nav-next" href="/reversing-client-side-encryption/"> <div class="nav-arrow">Next</div> <span class="post-title">Reverse Engineering Client side Encryption</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="https://github.com/thevillagehacker/"> <img align="center" alt="Naveen's GitHub" width="30px" src="https://img.icons8.com/color/github.png"/></a> <a class="footer_item" href="https://www.linkedin.com/in/thevillagehacker/"> <img align="center" alt="Naveen's LinkedIn" width="30px" src="https://img.icons8.com/color/linkedin.png"/> </a> <a class="footer_item" href="mailto:nvnj1998@gmail.com"> <img align="center" alt="Naveen's E-Mail" width="30px" src="https://img.icons8.com/color/gmail.png" /> </a> <a class="footer_item" href="https://twitter.com/thevillagehackr"> <img align="center" alt="Naveen's twitter" width="30px" src="https://img.icons8.com/color/twitter.png" /> </a><br> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
