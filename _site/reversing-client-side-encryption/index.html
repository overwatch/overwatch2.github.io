<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Naveen J" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Naveen J" /> <title> Reverse Engineering Client side Encryption - Naveen J </title> <link rel="alternate" href="http://localhost:4000/reversing-client-side-encryption/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/reversing-client-side-encryption/" /> <meta name="description" content="Reverse Engineering client side Encryption" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Reverse Engineering Client side Encryption | Naveen J" /> <meta property="og:title" content="Reverse Engineering Client side Encryption | Naveen J" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/reversing-client-side-encryption/" /> <meta property="og:description" content="Reverse Engineering client side Encryption" /> <meta property="og:image" content="" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Reverse Engineering Client side Encryption | thevillagehackr" /> <meta name="twitter:url" content="http://localhost:4000/reversing-client-side-encryption/" /> <meta name="twitter:site" content="@thevillagehackr" /> <meta name="twitter:creator" content="@thevillagehackr" /> <meta name="twitter:description" content="Reverse Engineering client side Encryption" /> <meta name="twitter:image" content="" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Naveen J" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/blog/">Blog</a><a class="menu-link" href="/about/">About</a><a class="menu-link" href="/projects/">Projects</a><!-- <a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a>---> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#reverse-engineering">REVERSE ENGINEERING</a> </span> </div> <h1 class="header-title" itemprop="headline">Reverse Engineering Client side Encryption</h1> <div class="post-meta"> <time datetime="2023-02-18T12:00:00+00:00" itemprop="datePublished"> Feb 18, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Naveen J</span> </span> <time hidden datetime="" itemprop="dateModified"> Feb 18, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">Naveen J</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h2 id="target-background">Target Background</h2> <p>Target is a web application but the same can be accessed via mobile applications as well including both android and iOS apps. The target application has a centralized CDN system which clearly shows that the target has several application with similar features and the resources served are almost same. By doing subdomain enumeration the target has more than 15 application has the same tech and all of them are served by the Amazon CDN.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h2 id="target-background"> <a href="#target-background" class="anchor-head"></a> Target Background </h2> <p>Target is a web application but the same can be accessed via mobile applications as well including both android and iOS apps. The target application has a centralized CDN system which clearly shows that the target has several application with similar features and the resources served are almost same. By doing subdomain enumeration the target has more than 15 application has the same tech and all of them are served by the Amazon CDN.</p> <h2 id="overview"> <a href="#overview" class="anchor-head"></a> Overview </h2> <p>Recon is the most important thing in finding bugs in the wide targets. While doing recon i came up with the situation which is the application has been developed to encrypt all the communication. The application is using the REST API service and the host value in the REST API calls have different subdomain. All the data body in the request and response has been coded in a way to encrypt to make sure the comms is secured. But as far as the developer decided to hardcode the encryption keys and Initialization vectors in the client side code the application is never secured even itâ€™s coded to provide an encrypted connection.</p> <h2 id="recon"> <a href="#recon" class="anchor-head"></a> Recon </h2> <ul> <li>Check the technology stack - ReactJS</li> <li>CDN - Amazon CDN</li> <li>API service - REST API</li> <li>REST API host is different than actual application URL</li> <li>Check the sources that has been loaded in the debugger/sources tab in the browser dev tools</li> <li>Check the REST API comms, authorization mechanism and encryptions</li> </ul> <h2 id="analyzing-loaded-sources"> <a href="#analyzing-loaded-sources" class="anchor-head"></a> Analyzing loaded sources </h2> <p>As far as we know the target has a wide scope and they have same CDN system with almost similar code. And the REST API JSON bodies are encrypted so if we find a way to reverse engineer the client side encryption that will possibly lead us to exploit more vulnerablities.</p> <p><strong>Target - abc.com</strong><br /> When the application is loaded in the browser it loads the web resources from another subdomain <code class="language-plaintext highlighter-rouge">assets.abc.com</code>. It would be the good idea to check the JS files other than the chunk files which are generated by the frameworks.</p> <h3 id="files-found"> <a href="#files-found" class="anchor-head"></a> Files found </h3> <ul> <li>booking.js</li> <li>desktop.js</li> <li>home.js</li> <li>search.js</li> <li>signin.js</li> <li>signup.js</li> <li>main.js</li> </ul> <p>By going through all the js files to check for keywords like <code class="language-plaintext highlighter-rouge">enc, encrypt, key, IV, initialization, vector</code> found nothing. But when i checked the <strong>main.js</strong> file i came up with few handy details which was worth checking for.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">91622</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
      <span class="nx">t</span><span class="p">.</span><span class="nx">Z</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">apiDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://api.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">adminDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://admin.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">searchApiDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://search.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">searchApiDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://search.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">preprodApiDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://preprod.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">bookingApiDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://bookings.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">blogsApiDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://secure.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">analyticsDomain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://analytics.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">cdnPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://cdn.abc.com</span><span class="dl">'</span><span class="p">,</span>       
        <span class="na">s3accessKeyId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-############</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">s3secretKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-############</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">s3Region</span><span class="p">:</span> <span class="dl">'</span><span class="s1">west</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">dataHasKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">###################=</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">dataIVKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">jm8lgqa3j1d0ajus</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">zendesk</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#   ##########################</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">giftCardUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://join.abc.com/gift-card/</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">ASSET_CDN_PATH</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://assets.abc.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">consoleEnv</span><span class="p">:</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recaptchaV2Key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">###################-kAQFKNGH-</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">SHOPBACK_URL_DYNAMIC</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://shopback.abc.org/aff_l</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">SHOPBACK_MERCHANT_ID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#########</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">encryptionKeys</span><span class="p">:</span> <span class="dl">'</span><span class="s1">["##_analytics_detail||VWlRMVRtTnllWEJVSVRCdUo=","club_membership_detail||RFZEVW1WMEtFQlJKSDA9"]</span><span class="dl">'</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div> <p>After analyzing the code, finally i came to a conclusion that the application was loading resources from another CDN too and this main.js file only has the Initialization vector which was referred as <code class="language-plaintext highlighter-rouge">dataIVKey</code> in the code.</p> <p>Letâ€™s load the application in the browser and check the encryption in the REST API.</p> <figure> <img src="reqandresp.png" /> <figcaption>Fig 1. Request and response</figcaption> </figure> <p>Alright! letâ€™s check the JS source files in the CDN subdomain <code class="language-plaintext highlighter-rouge">cdnPath: 'https://cdn.abc.com'</code>. The subdomain has lots of files but there was only one file which is different than the other files <strong><em>app.js</em></strong>. The app.js file contains the below details which we need for our further exploitation.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">abc</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="dl">'</span><span class="s1">SiteSettingService</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">$cookies</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">$http</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">$q</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">SiteSettings</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">$rootScope</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">UrlFormatter</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">LocalStorage</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">$location</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">MessageModal</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">blockUI</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">EncryptDecrypt</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">SearchConditions</span><span class="dl">'</span>
  <span class="p">]</span>
</code></pre></div></div> <p>The JS file has the function to encrypt and decrypt the API body in the HTTP request and response. Searching the keyword <code class="language-plaintext highlighter-rouge">encrypt</code> led me right into the encryt and decrypt function code as below.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">abc</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="dl">'</span><span class="s1">EncryptDecrypt</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">AppSettings</span><span class="dl">'</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">encryptKEY</span><span class="p">:</span> <span class="dl">'</span><span class="s1">UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0=</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">setkey</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">encryptKEY</span> <span class="o">=</span> <span class="nx">t</span>
      <span class="p">},</span>
      <span class="na">encrypt</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">encryptKEY</span><span class="p">,</span>
        <span class="nx">n</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">jm8lgqa3j1d0ajus</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="p">{</span>
          <span class="na">iv</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">n</span><span class="p">),</span>
          <span class="na">padding</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span><span class="p">,</span>
          <span class="na">mode</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span>
        <span class="p">}).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">---</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
      <span class="p">},</span>
      <span class="na">decrypt</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">---</span><span class="dl">'</span><span class="p">),</span>
        <span class="nx">n</span> <span class="o">=</span> <span class="nx">browserCrypto</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">),</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">browserCrypto</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">),</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="nx">browserCrypto</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">encryptKEY</span><span class="p">),</span>
        <span class="nx">o</span> <span class="o">=</span> <span class="nx">browserCrypto</span><span class="p">.</span><span class="nx">createDecipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">_update</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">final</span><span class="p">(),</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">browserCrypto</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="nx">i</span><span class="p">,</span>
        <span class="nx">s</span><span class="p">])).</span><span class="nx">toString</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">])</span>
</code></pre></div></div> <p>By reading the above code we clearly have an idea of what are the tools are required to break down this API encryption wall.</p> <h3 id="handy-tools-to-break-the-wall"> <a href="#handy-tools-to-break-the-wall" class="anchor-head"></a> Handy tools to break the wall </h3> <p>Encryption key = UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0= IV = jm8lgqa3j1d0ajus Encryption Mode = CBC Encryption Algorithm = AES</p> <h2 id="lets-break"> <a href="#lets-break" class="anchor-head"></a> Letâ€™s break </h2> <p>I used the online AES decruption application you can find it <a href="https://www.devglan.com/online-tools/aes-encryption-decryption">here</a>. Before start decrypting the json body letâ€™s go through the code first. The below line in the code shows that the final payload is created by adding the encrypted payload and <code class="language-plaintext highlighter-rouge">---</code> dashes and then follwed by the base64 encoded IV.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="p">{</span>
          <span class="na">iv</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">n</span><span class="p">),</span>
          <span class="na">padding</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span><span class="p">,</span>
          <span class="na">mode</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span>
        <span class="p">}).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">---</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>        
</code></pre></div></div> <p><strong><em>btoa()</em></strong> method is used for encoding a string in base-64 format, so the IV will be encoded in base64 format.</p> <p>Letâ€™s break down the final payload the API is sending to the server.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"data"</span><span class="p">:</span><span class="s2">"Ht2YM+y/yp4cn11iaWs/PmqQlSuLgrxMZwrQKnAt+qwRBYL2gt3uCHtPWC4soU1j0861mHg4Ij2jSJ0sq5R4iQK0lJ25hRjDf8OqwpNG97jv5jcCSNSFyYhjLqZYRGeFTLcxM7p4Jj9dl54LcXYWCPgAinKdQiPx/y9NC1g02g06HtCLFNFZlrTtJXPoFA70vkuT3VF84pHS+0yX3tVS0d0+b0AYlrePSuF8qxfnGGCcnhcbD/tCqesu3gFp3VCvZUaAnc9SzQlpF04a/D3R+izDG97FHEIFDsULmX0YOW5tEoUcsWRbDTfuswChDmrpNx6wMK8VR5+oSMF5r/y8eWEak0Xiaa9vc8J/TIt+j26pvDIgHRzCwfe7E9NpbBgiTt9OqoyZEyL61PRZ5UybCqqfj659WBKbF3B6ThQNQWw56CJDUTGp3sK59izgl4Bn3P76MvlpDC7rg4JTmprlk1BqxvMjmG/vqZn6IXUDR+TNHr+6zCfSTDkbeYKojs663BvddsrJIuhzgFryHe3DUZFnOahR1ViDanCahRZFkK97mfxUwHfAfJqkWkkpEhpAEV1ZUiBUpohmCWIYxjxtOBo9M9oiAxcAHZW9rbVu1X1KyadnRnO/i4JU40e8EmwsokGoufbi5Z5wOgK9sEO9LFTDH5LnF+UwXBM25oI3UFmwWrrYljNPdexm4iksslRUZGx1FQa1BlHQ8hGH+ch+ZOFu/AI8wfWx0v6lUiAx8ZTpmb+JQDb90S38rMIuh08frCixM9uyNiP1ue/W6lPW4GThtLSXcT+Ua+d4xrIHaEXP4mNNSUIQwUSo2m7kq3OoxNpbvjd3EtM9EkyJEIXcI0nn7cXuTfRpmJNMzJ0mrx6wMgJkPGJVrttNfhP4/FUXj/RrG4KYt+bpHrd7vExXNYYQCHRCKjRUzvr1ON99wBkaSHzvKHz9x/i0IMQ9kNBNB3Bge9mTsHaYs3nFqQOXS+HkASZkmc0jF+dK33X2fv8tBfJvQF4FL2AFPKyvPId3cq+RWLmvWde9h19ewuLBX/0adpiDea7HgnnIH3NewQhcrCZvfWodqtmhPKowtwk1---am04bGdxYTNqMWQwYWp1cw=="</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>In the last line in the final payload there are 3 <code class="language-plaintext highlighter-rouge">---</code> dashes and followed by base64 encoded string which is the dataIV.</p> <p>Alright! let decrypt the request payload and letâ€™s see how can we create an actual impact.</p> <h3 id="decrypting-the-request-data"> <a href="#decrypting-the-request-data" class="anchor-head"></a> Decrypting the request data </h3> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"textToEncrypt"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"textToDecrypt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ht2YM+y/yp4cn11iaWs/PmqQlSuLgrxMZwrQKnAt+qwRBYL2gt3uCHtPWC4soU1j0861mHg4Ij2jSJ0sq5R4iQK0lJ25hRjDf8OqwpNG97jv5jcCSNSFyYhjLqZYRGeFTLcxM7p4Jj9dl54LcXYWCPgAinKdQiPx/y9NC1g02g06HtCLFNFZlrTtJXPoFA70vkuT3VF84pHS+0yX3tVS0d0+b0AYlrePSuF8qxfnGGCcnhcbD/tCqesu3gFp3VCvZUaAnc9SzQlpF04a/D3R+izDG97FHEIFDsULmX0YOW5tEoUcsWRbDTfuswChDmrpNx6wMK8VR5+oSMF5r/y8eWEak0Xiaa9vc8J/TIt+j26pvDIgHRzCwfe7E9NpbBgiTt9OqoyZEyL61PRZ5UybCqqfj659WBKbF3B6ThQNQWw56CJDUTGp3sK59izgl4Bn3P76MvlpDC7rg4JTmprlk1BqxvMjmG/vqZn6IXUDR+TNHr+6zCfSTDkbeYKojs663BvddsrJIuhzgFryHe3DUZFnOahR1ViDanCahRZFkK97mfxUwHfAfJqkWkkpEhpAEV1ZUiBUpohmCWIYxjxtOBo9M9oiAxcAHZW9rbVu1X1KyadnRnO/i4JU40e8EmwsokGoufbi5Z5wOgK9sEO9LFTDH5LnF+UwXBM25oI3UFmwWrrYljNPdexm4iksslRUZGx1FQa1BlHQ8hGH+ch+ZOFu/AI8wfWx0v6lUiAx8ZTpmb+JQDb90S38rMIuh08frCixM9uyNiP1ue/W6lPW4GThtLSXcT+Ua+d4xrIHaEXP4mNNSUIQwUSo2m7kq3OoxNpbvjd3EtM9EkyJEIXcI0nn7cXuTfRpmJNMzJ0mrx6wMgJkPGJVrttNfhP4/FUXj/RrG4KYt+bpHrd7vExXNYYQCHRCKjRUzvr1ON99wBkaSHzvKHz9x/i0IMQ9kNBNB3Bge9mTsHaYs3nFqQOXS+HkASZkmc0jF+dK33X2fv8tBfJvQF4FL2AFPKyvPId3cq+RWLmvWde9h19ewuLBX/0adpiDea7HgnnIH3NewQhcrCZvfWodqtmhPKowtwk1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"secretKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0="</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CBC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"keySize"</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w">
    </span><span class="nl">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJmaXJzdF9uYW1lIjoidGVzdCIsImxhc3RfbmFtZSI6InVzZXIiLCJlbWFpbCI6Im5qQHR2aHNlYy5jb20iLCJwaG9uZSI6IjkxODc5NDU2MzIxNCIsInBhc3N3b3JkIjoiUGFzc0AxMjMiLCJjb25maXJtX3Bhc3N3b3JkIjoiUGFzc0AxMjMiLCJpc191bnN1YnNjcmliZWQiOnRydWUsImNhcHRjaGEiOiIwM0FGWV9hOFhONGNCUVFjMGRnQnNlYTRKc1NEdEpuYTFGb09yX1BWYlFOeGYwSnpLZEdLRXNyeWpfWXNKazlQQ05aaDhWNmV3R1dLam1xQkMyQzJ0NWNvSmR4OWFaZ00wUGRCbDRfMzQ1dTE0MlZrXzhDT2c4R3Z4dXRmRjJvQ1p6WGVUTVdnVmNXMlpnMzFMNWszd3VXVkVnSlFnQXJOZ1E0VUhwYW5BQ1lkeEZpTENRYl84SUpTMWdEbVNKY3pZZHRYZ1kybnNBOGQ3Sl9sd0xJNHJnb1Y1Z2IwVXAzWnJSUEZKTnduUk4tS3h0d0dtRGJpYjk2TF9ZbDF6Ym03TFZjSkJNRzZhbDJyMEw1dGt1eFdsdTV0RTZ4MTIzYWNFQ0lQUVJkMktKN2Fwc1owbkd3VF9GdFEtMnJCbjVRTDJtU0x5a0tlQ3ZsNFE1TUphZlR6OTV6ODNJcEs5QVZWUkwwRWl5dENVWjhSQ205NzRoOV9xTTVLa091RXoxQmU3THpMRDJFUzNpNjJQbHZvUGZ6UXlMV3RaUWNSSDRPTWhvcTlMMkduUXVTbE5SaHRqNGVycVRhdkV3eC1ZQklPNnpqeFdWWnBtTm5LWG1uREk0amZNa3FTUk1EaTVqdFFHeXYxQ0tMRVMyRHU0MTFkaGNYR3ZqVVhQSUh3SUlrTDhCdl9weWlENmJSTkdHdXJJSkhEWTZFdDlzUVBRbWJmU2JxQnYxNm1Fd0dxbEdmMWk4LThMbUQ1RSIsInZlcnNpb24iOiJ2MiIsInJlY3RWaWV3IjoidnVlIiwic291cmNlIjoiTG9naW5BY3Rpdml0eSJ9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dataFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Base64"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"iv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jm8lgqa3j1d0ajus"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>decode the base64 encoded output from the above</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nj@tvhsec.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"918794563214"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pass@123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"confirm_password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pass@123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"is_unsubscribed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"captcha"</span><span class="p">:</span><span class="w"> </span><span class="s2">"03AFY_a8XN4cBQQc0dgBsea4JsSDtJna1FoOr_PVbQNxf0JzKdGKEsryj_YsJk9PCNZh8V6ewGWKjmqBC2C2t5coJdx9aZgM0PdBl4_345u142Vk_8COg8GvxutfF2oCZzXeTMWgVcW2Zg31L5k3wuWVEgJQgArNgQ4UHpanACYdxFiLCQb_8IJS1gDmSJczYdtXgY2nsA8d7J_lwLI4rgoV5gb0Up3ZrRPFJNwnRN-KxtwGmDbib96L_Yl1zbm7LVcJBMG6al2r0L5tkuxWlu5tE6x123acECIPQRd2KJ7apsZ0nGwT_FtQ-2rBn5QL2mSLykKeCvl4Q5MJafTz95z83IpK9AVVRL0EiytCUZ8RCm974h9_qM5KkOuEz1Be7LzLD2ES3i62PlvoPfzQyLWtZQcRH4OMhoq9L2GnQuSlNRhtj4erqTavEwx-YBIO6zjxWVZpmNnKXmnDI4jfMkqSRMDi5jtQGyv1CKLES2Du411dhcXGvjUXPIHwIIkL8Bv_pyiD6bRNGGurIJHDY6Et9sQPQmbfSbqBv16mEwGqlGf1i8-8LmD5E"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rectView"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vue"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LoginActivity"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Now we have successfully decoded the JSON body and now we have to construct a fully working JSON payload to send it to the server, for that we have to contruct a payload as below in the js code.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="p">{</span>
          <span class="na">iv</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">n</span><span class="p">),</span>
          <span class="na">padding</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span><span class="p">,</span>
          <span class="na">mode</span><span class="p">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span>
        <span class="p">}).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">---</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</code></pre></div></div> <p>Valid request body = Encrypted payload + <code class="language-plaintext highlighter-rouge">---</code> + base64 encoded IV</p> <p><strong>Encrypted Payload</strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"textToEncrypt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">first_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">enc</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">last_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">user</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">email</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">nj+1@tvhsec.com</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">phone</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">918794563214</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">password</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">Pass@123</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">confirm_password</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">Pass@123</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">is_unsubscribed</span><span class="se">\"</span><span class="s2">: true,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">captcha</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">03AFY_a8XN4cBQQc0dgBsea4JsSDtJna1FoOr_PVbQNxf0JzKdGKEsryj_YsJk9PCNZh8V6ewGWKjmqBC2C2t5coJdx9aZgM0PdBl4_345u142Vk_8COg8GvxutfF2oCZzXeTMWgVcW2Zg31L5k3wuWVEgJQgArNgQ4UHpanACYdxFiLCQb_8IJS1gDmSJczYdtXgY2nsA8d7J_lwLI4rgoV5gb0Up3ZrRPFJNwnRN-KxtwGmDbib96L_Yl1zbm7LVcJBMG6al2r0L5tkuxWlu5tE6x123acECIPQRd2KJ7apsZ0nGwT_FtQ-2rBn5QL2mSLykKeCvl4Q5MJafTz95z83IpK9AVVRL0EiytCUZ8RCm974h9_qM5KkOuEz1Be7LzLD2ES3i62PlvoPfzQyLWtZQcRH4OMhoq9L2GnQuSlNRhtj4erqTavEwx-YBIO6zjxWVZpmNnKXmnDI4jfMkqSRMDi5jtQGyv1CKLES2Du411dhcXGvjUXPIHwIIkL8Bv_pyiD6bRNGGurIJHDY6Et9sQPQmbfSbqBv16mEwGqlGf1i8-8LmD5E</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">version</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">v2</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">rectView</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">vue</span><span class="se">\"</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="se">\"</span><span class="s2">source</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">LoginActivity</span><span class="se">\"\n</span><span class="s2">}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"textToDecrypt"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"secretKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0="</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CBC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"keySize"</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w">
    </span><span class="nl">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7LJE5P5kV3HvDdOdxWPQkQDbwqlTp2817vWfuCp/F3CzdTj9rWvrAlisK7/pRR0ff7g6Fd16im4Zrw1Zac5qHSbTRmV2cyvHgKcRwtonAGnU0toMYEuPkXdswUGKKgJRkZ0nQcYZVsPRX5D2gWoglp4kzFHZM8Y1dtVQLoYeqi3pc8vKI5FU5AeeTqZdAWWVEJcsZIlKY2o94fVzrXJ1XD/95aLXk3wbfDhJDP50jMfSM8TAl4Oa7mBbpMArnNU4XJscqfuXrXc5KyxvyPbmc/IwA7ndlhljJJ7zMjtnS9GzzkYjuWdISkLB1rH/pvXS7AUEj0UpIn2DBIsHayVYkBYHaRP6YZ8vVZGMoXVK1kS6w1W6JFUOzkfcTMWVbKAifJxxtlzt5cuJZa/iDHTMMrh/xAOqc04mdn73sBGAFMN5KlJx0lEe8XlKFkm3UcRdrzLj0/VmLHAN75dXX7iNs5ZvswYr8EcHG2fscIIoJ3mtySlDVgcR1fl8ZIcSXLVAzzazF8ZldJ9bzExMrFqUK73R9ZE5sEJIgoWqotlBIWUxC8WtfY8aLLcWiDHaPvoGtS5lnajJ0/zx5oHEFKdZaGDsGjOycGHeJbZgkDU5u3WhzrgTw8+FaNqluT+vDPHTlxpDPy/h1I7TL1YfpjLeUjSIEY2gYmD1Ew/ii5lBBPcqI7F3gWNh+t/wt7Y7xSmXJ92Z9X93iVAiM27yEnbreC8i5GQzU+OgqPogrEw8Lu0m86cpgGfXrv1bL2ihxW9fNKEWCexMx0U0cHdlqDVdoQ3PcyutXRvZH58F81Aw2jL0O6GC7/ijYN59gboFhoh7Fh0GWRlRkMA2gXnGgNZejFUE8qzTnusINmEeGwbmdIQ18w/WGKT0V5ZvCDbjVCIHK8fOx+64y0oJ4tN7a2/idP5Xlciz1qsitfuCB+7DBhIgSpOXbG+Pe6mW9lW31qlyljabDpk3SdX+X9z+9Hh7/7QooghpXePk+snSTtqHPxWlKI/np5cGcBmnB8kZXGOyyeBuLOciKdEdqJ8Luu6huLGNSo9ftaDgn9TMjcBw2c2MU6sClP31DYTlfake9iaFrXrdisi+YorPU4g+T8ojrVpDGWnnh1uHjc8KsTlsULU="</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dataFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Base64"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"iv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jm8lgqa3j1d0ajus"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><strong><em>Newly constructed request</em></strong> <img src="reqandresp2.png" alt="img" /><br /></p> <p>Now itâ€™s time to exploit issues and create a huge impact. Based on the decrypted data as we can see, the application is using the CAPTCHA system to protect the application from the brute-forcing and spamming vulnerabilities. If we can find a way to bypass the CAPTCHA protection then we can convince the triager to show the real imapcts like high resource usage, spamming and by create user accounts with false data. The last part creating false accounts using false data is only applicable when the application does not have data verification system. As per the recon the application is not validating anything at all, so now we can show the impact.</p> <p>Letâ€™s jump into find a way to bypass the CAPTCHA.</p> <h3 id="captcha-recon"> <a href="#captcha-recon" class="anchor-head"></a> CAPTCHA Recon </h3> <p>The application is using google reCAPTCHA.</p> <p><img src="captcha.png" alt="img" /><br /></p> <p>I have observed there was a strange behaviour in the reCAPTCHA system which is everytime you click the checkbox it sends two requests such as 1 to get the CAPTCHA response and other is to verify the CAPTCHA response in the next upcoming request.</p> <h3 id="bypass"> <a href="#bypass" class="anchor-head"></a> Bypass </h3> <p>We cannot send the same CAPTCHA response code more than once, if we do that the server will respond as below,</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
Date: Sat, 18 Feb 2023 14:54:03 GMT
Expires: Sat, 18 Feb 2023 14:54:03 GMT
Cache-Control: private, max-age=0
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Security-Policy: frame-ancestors 'self'
X-Xss-Protection: 1; mode=block
Content-Length: 32
Server: GSE
Alt-Svc: h3=":443"; ma=2592000,h3-29=":443"; ma=2592000

)]}'
["uvresp",null,null,null,2]
</span></code></pre></div></div> <p>From the below request what i have observed is you can send the below CAPTCHA request as long as we want and it will still provide us the response code to be verified in the upcoming verification request.</p> <p><img src="captcha1.png" alt="img" /></p> <h3 id="workflow"> <a href="#workflow" class="anchor-head"></a> Workflow </h3> <p>Get CAPTCHA code -&gt; use it in next verfication request -&gt; will provide the final CAPTCHA code which is included in the JSON body</p> <p>The final verification code can be obtained like the below,</p> <p><img src="captcha2.png" alt="img" /></p> <p>So the entire flow will be automated by using a python script to get the final CAPTCHA code to be encrypted in the JSON body to create accounts/any other operations like brute-forcing usernames and passwords.</p> <p>By chaining the client side code encryption reverse engineering and the misconfigured CAPTCHA mechanism will allow us to create false accounts, resource consumption, increased data tables in DB which will add more cost to the companyâ€™s usage bill.</p> <p>Thank you for reading.</p> <p>Follow me on Twitter : <a href="https://twitter.com/thevillagehackr">thevillagehacker</a></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/RCE-DLL-Hijacking/" > <div class="nav-arrow">Previous</div> <span class="post-title">DLL Injection on one of the biggest Business Automation application</span> </a> <a class="post-nav-item post-nav-next" href="/Hacking_MNCs-CMS_Systems/"> <div class="nav-arrow">Next</div> <span class="post-title">Hacking MNC's Content Management System due to misconfiguration and lack of authorization</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="https://github.com/thevillagehacker/"> <img align="center" alt="Naveen's GitHub" width="30px" src="https://img.icons8.com/color/github.png"/></a> <a class="footer_item" href="https://www.linkedin.com/in/thevillagehacker/"> <img align="center" alt="Naveen's LinkedIn" width="30px" src="https://img.icons8.com/color/linkedin.png"/> </a> <a class="footer_item" href="mailto:nvnj1998@gmail.com"> <img align="center" alt="Naveen's E-Mail" width="30px" src="https://img.icons8.com/color/gmail.png" /> </a> <a class="footer_item" href="https://twitter.com/thevillagehackr"> <img align="center" alt="Naveen's twitter" width="30px" src="https://img.icons8.com/color/twitter.png" /> </a><br> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- KlisÃ© Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisÃ©</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
