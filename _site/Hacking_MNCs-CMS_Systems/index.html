<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Naveen J" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Naveen J" /> <title> Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization - Naveen J </title> <link rel="alternate" href="http://localhost:4000/Hacking_MNCs-CMS_Systems/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/Hacking_MNCs-CMS_Systems/" /> <meta name="description" content="Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization in the application." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization | Naveen J" /> <meta property="og:title" content="Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization | Naveen J" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/Hacking_MNCs-CMS_Systems/" /> <meta property="og:description" content="Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization in the application." /> <meta property="og:image" content="" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization | thevillagehackr" /> <meta name="twitter:url" content="http://localhost:4000/Hacking_MNCs-CMS_Systems/" /> <meta name="twitter:site" content="@thevillagehackr" /> <meta name="twitter:creator" content="@thevillagehackr" /> <meta name="twitter:description" content="Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization in the application." /> <meta name="twitter:image" content="" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Naveen J" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/blog/">Blog</a><a class="menu-link" href="/about/">About</a><a class="menu-link" href="/projects/">Projects</a><!-- <a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a>---> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#reading-js-files">READING JS FILES</a>, <a class="tag" href="/tags/#privilege-escalation">PRIVILEGE ESCALATION</a>, <a class="tag" href="/tags/#fuzzing">FUZZING</a>, <a class="tag" href="/tags/#misconfiguration">MISCONFIGURATION</a> </span> </div> <h1 class="header-title" itemprop="headline">Hacking MNC&#39;s Content Management System due to misconfiguration and lack of authorization</h1> <div class="post-meta"> <time datetime="2023-03-25T12:00:00+00:00" itemprop="datePublished"> Mar 25, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Naveen J</span> </span> <time hidden datetime="" itemprop="dateModified"> Mar 25, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">Naveen J</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h2 id="target-background">Target Background</h2> <p>The target is a Multi National Company who has a billion dollar market and the stocks. The nature of the application is to create, edit and update the contents of their products/services. Once the content is published the updated contents will be pushed to the live website of the product/services page. Short form it’s a <strong>Content Management System application</strong> - its a own product of the company built using reactJS.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h2 id="target-background"> <a href="#target-background" class="anchor-head"></a> Target Background </h2> <p>The target is a Multi National Company who has a billion dollar market and the stocks. The nature of the application is to create, edit and update the contents of their products/services. Once the content is published the updated contents will be pushed to the live website of the product/services page. Short form it’s a <strong>Content Management System application</strong> - its a own product of the company built using reactJS.</p> <h2 id="overview"> <a href="#overview" class="anchor-head"></a> Overview </h2> <p>The application does not have any sign up page as this is a CMS application only the administrator of the application can create and assign roles to the users. The home page didn’t have any sign up buttons other than the login form - username, password, submit and forgot password buttons.</p> <h3 id="recon"> <a href="#recon" class="anchor-head"></a> Recon </h3> <ul> <li>reactJS</li> <li>Amazon CDN</li> <li>REST APIs</li> </ul> <h3 id="analyzing-loaded-source-files"> <a href="#analyzing-loaded-source-files" class="anchor-head"></a> Analyzing loaded source files </h3> <p>After analyzing the loaded source files in the application it clearlys shows that the user has to be legitimate to access the application. There were no REST API locations were mentioned in the JS files. The perfect way to proceed further is to fuzz the URL. After fuzzing the URL the signup endpoint were found <strong>https://abc.com/abc/xyz/signup.html</strong>.</p> <h2 id="misconfiguration---1"> <a href="#misconfiguration---1" class="anchor-head"></a> Misconfiguration - 1 </h2> <h3 id="sign-up"> <a href="#sign-up" class="anchor-head"></a> Sign up </h3> <p>Since the application does not have the signup option in the home page and the same has been configured in the different directory than the home login page. The developer might be intentionally did it or might have used it for internal purpose or forgot to remove from the directory.</p> <p>I have signed up an account, and luckily it doesn’t ask to confirm the information provided like email confirmation to create an account sccessfully.</p> <p>After creating a user successfully, i have tried to login to the application but since the signed up user is not a legitmate user and no roles have been assigned to it, the application kept redirecting me to login page. The application contents were not accessible. But I was able to extract the embeded REST API locations from the page because we are able to login to the application but only the application pages are not available in the UI due to incorrect permissions.</p> <p>So i have decided to circle back to the login request to understand the flow and what we are missing, after successfull login the application serves the authorization token (JWT) in the Location header along with the URL. I was able to decode the JWT and it doesn’t has any values for the cognito permission which solve the question why the contents are unavailable.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"at_hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ry3UaTl8rD1IPBffLSyQ7w"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e03f561e-9392-437d-abf7-48715fde4a4e"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cognito:groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">""</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://cognito-idp.abc.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cognito:username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"origin_jti"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cognito:roles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">""</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2kp93i4kj1ump55lid961qm7bv"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"65f7336b-1b89-45e6-b9f9-be466f24207b"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"token_use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"auth_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"phone_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"jti"</span><span class="p">:</span><span class="w"> </span><span class="s2">"66d3189d-e26e-454f-9b8d-7863ac4de102"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nj@tvhsecurity.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>After decoding the JWT, it showed that the user doesn’t have any assigned roles to access the application pages.</p> <h3 id="fuzzing-jwt"> <a href="#fuzzing-jwt" class="anchor-head"></a> Fuzzing JWT </h3> <p>In order to find the right <code class="language-plaintext highlighter-rouge">cognito groups</code> we have to fuzz the JWT payload but by adding random role permissions keywords, encoding it and sending it in the request turned to be a failure.</p> <p>But with the token i was able to download page source through curl by passing the <strong>authorization header</strong>. After downloading the page source i have used one of my own oneliners to extract the URL locations embeded in the application and I was able to successfull get a few static pages and REST API paths. We can also the <a href="https://github.com/thevillagehacker/urlscrapy">URLScrapy</a> a tool to extract the embeded location in the web page.</p> <h2 id="http-response-code"> <a href="#http-response-code" class="anchor-head"></a> HTTP response code </h2> <p>I have placed all of the extracted URLs in a text file and used <strong><a href="https://github.com/projectdiscovery/httpx">HTTPX</a></strong> to check the status code and content length, luckily one of the page returned with different content length. After visiting the page it showed some static contents about the user role in the application.</p> <p>So with the help of that recon i knew there are 2 user roles in the application which are <code class="language-plaintext highlighter-rouge">editor</code> and <code class="language-plaintext highlighter-rouge">publisher</code>. The editor user can edit the contents and pubshier can approve those new contents.</p> <h2 id="checkpoint"> <a href="#checkpoint" class="anchor-head"></a> Checkpoint </h2> <p>Let’s check what do we have as of now to access the application contents.</p> <ul> <li>Newly signup account without any roles</li> <li>user roles in the application</li> <li>Working JWT token (Authorization)</li> </ul> <p>Alright! now we have to find a way to assign the user roles to the token and access the application contents. After playing with dev-tools for a while i have noticed there is a variable in the local storage <code class="language-plaintext highlighter-rouge">user_role</code> which is empty by the way for our user account. So i have set an value as <code class="language-plaintext highlighter-rouge">editor</code> and refreshed the page.</p> <p>Voila! the application is checking the local storage variables as well to serve the content of the application, I was able to add and edit application contents.</p> <h2 id="misconfiguration---2"> <a href="#misconfiguration---2" class="anchor-head"></a> Misconfiguration - 2 </h2> <p>Now we are able to access the application which concludes that the application is using aws cognito groups as authentication only and it was not used for authorization because we were able to become an editor user in the application by adding value as <code class="language-plaintext highlighter-rouge">editor</code> to the local storage variable <code class="language-plaintext highlighter-rouge">user_role</code>.</p> <p>So we only need an legitimate authentication token to access the REST APIs, since the authorization is not implemented.</p> <h3 id="privilege-escalation"> <a href="#privilege-escalation" class="anchor-head"></a> Privilege Escalation </h3> <p>I have escalated the privilege of <code class="language-plaintext highlighter-rouge">publisher</code> user by changing the local storage variable <code class="language-plaintext highlighter-rouge">user_role</code> to <code class="language-plaintext highlighter-rouge">publisher</code>. After refreshing the page i was able to access the publisher contents pages in which we can approve and reject contents which have been added by the editor users in the application.</p> <p>Please note that due to the non-disclosure agreement these are the only information i was allowed to share.</p> <p>Thank you for reading.</p> <p>Follow me on Twitter : <a href="https://twitter.com/thevillagehackr">thevillagehacker</a></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/reversing-client-side-encryption/" > <div class="nav-arrow">Previous</div> <span class="post-title">Reverse Engineering Client side Encryption</span> </a> <a class="post-nav-item post-nav-next" href="/Account_Takeover-via-session-storage/"> <div class="nav-arrow">Next</div> <span class="post-title">Account Takeover via manipulating Session Storage</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="https://github.com/thevillagehacker/"> <img align="center" alt="Naveen's GitHub" width="30px" src="https://img.icons8.com/color/github.png"/></a> <a class="footer_item" href="https://www.linkedin.com/in/thevillagehacker/"> <img align="center" alt="Naveen's LinkedIn" width="30px" src="https://img.icons8.com/color/linkedin.png"/> </a> <a class="footer_item" href="mailto:nvnj1998@gmail.com"> <img align="center" alt="Naveen's E-Mail" width="30px" src="https://img.icons8.com/color/gmail.png" /> </a> <a class="footer_item" href="https://twitter.com/thevillagehackr"> <img align="center" alt="Naveen's twitter" width="30px" src="https://img.icons8.com/color/twitter.png" /> </a><br> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
