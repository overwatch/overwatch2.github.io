<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Naveen J" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Naveen J" /> <title> RCE via File Upload - Naveen J </title> <link rel="alternate" href="http://localhost:4000/RCE_via_file_upload/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/RCE_via_file_upload/" /> <meta name="description" content="Remote Code Execution Due to Unrestricted File Upload." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="RCE via File Upload | Naveen J" /> <meta property="og:title" content="RCE via File Upload | Naveen J" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/RCE_via_file_upload/" /> <meta property="og:description" content="Remote Code Execution Due to Unrestricted File Upload." /> <meta property="og:image" content="" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="RCE via File Upload | thevillagehackr" /> <meta name="twitter:url" content="http://localhost:4000/RCE_via_file_upload/" /> <meta name="twitter:site" content="@thevillagehackr" /> <meta name="twitter:creator" content="@thevillagehackr" /> <meta name="twitter:description" content="Remote Code Execution Due to Unrestricted File Upload." /> <meta name="twitter:image" content="" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Naveen J" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/blog/">Blog</a><a class="menu-link" href="/about/">About</a><a class="menu-link" href="/projects/">Projects</a><!-- <a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a>---> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#remote-code-execution">REMOTE CODE EXECUTION</a>, <a class="tag" href="/tags/#misconfiguration">MISCONFIGURATION</a> </span> </div> <h1 class="header-title" itemprop="headline">RCE via File Upload</h1> <div class="post-meta"> <time datetime="2021-03-05T12:00:00+00:00" itemprop="datePublished"> Mar 05, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Naveen J</span> </span> <time hidden datetime="" itemprop="dateModified"> Mar 05, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">Naveen J</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h1 id="remote-code-execution">Remote Code Execution</h1> <p>Remote code execution (RCE) refers to the ability of a cyber attacker to access and make changes to a computer owned by another, without authority and regardless of where the computer is geographically located. RCE allows an attacker to take over a computer or a server by running arbitrary malicious software (malware).</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h1 id="remote-code-execution"> <a href="#remote-code-execution" class="anchor-head"></a> Remote Code Execution </h1> <p>Remote code execution (RCE) refers to the ability of a cyber attacker to access and make changes to a computer owned by another, without authority and regardless of where the computer is geographically located. RCE allows an attacker to take over a computer or a server by running arbitrary malicious software (malware).</p> <p>Found a target using google dorks which having a responsible disclosure program. Let’s consider the target as abc.com the target website has profile picture upload functionality. The developer configured the application not to accept other than whitelisted extensions as <code class="language-plaintext highlighter-rouge">*.gif, *.jpeg, *.png</code>.</p> <p><img src="1.webp" alt="img" /></p> <p>So I quickly wanted to check the application how handles if I upload files other than whitelisted ones.</p> <p><img src="2.webp" alt="img" /></p> <p>I uploaded the PHP file and observed that the application does not allow me to upload because of the validation present in the front end of the application.</p> <p><img src="3.webp" alt="img" /></p> <p>Minutes later I decided to change the <strong>Content-Type</strong> to bypass the client-side validation. I changed the Content-Type from <strong>application/octet-stream</strong> to image/png and <code class="language-plaintext highlighter-rouge">image/jpg and image/jpeg</code> but no luck but I do had a thought about to changing the content type into <strong>image/gif</strong> to see how it parses the file.</p> <p>Guess what the file successfully uploaded it seems the developer does not configure the content type and content of the uploaded files.</p> <p><img src="4.webp" alt="img" /></p> <p>I forwarded the file upload request and observed the following request which had the location of the file that we uploaded. Now we uploaded the file and have the location of where it stores all we have to do is to trigger the reverse shell.</p> <p><img src="5.webp" alt="img" /></p> <p>I quickly directed to the reverse_shell.php file location to trigger the reverse shell and all of the processes are correct but I didn’t have a reverse shell. And I finally found out that the server was configured to block outbound TCP connections.</p> <p>So I was thinking about how to bypass that and something came up to my mind what if I create a shell inside the server and view it inside the server, so I used <a href="https://github.com/flozz/p0wny-shell/blob/master/shell.php">powny shell</a> to create RCE.</p> <p><img src="6.webp" alt="img" /></p> <p>I uploaded the powny shell exactly I have done to upload reverse shell before and got the file location on followed request. Directed to the file location and the RCE is finally got triggered.</p> <p><img src="7.webp" alt="img" /></p> <h2 id="takeaways"> <a href="#takeaways" class="anchor-head"></a> Takeaways </h2> <ul> <li>Try changing content type while uploading restricted files.</li> <li>Check all the whitelisted file types that you can upload.</li> <li>If the server is configured to restrict outbound TCP connections try uploading a powny shell and trigger it which will create a web reverse shell inside the webserver.</li> </ul> <p>Thank you for reading.</p> <p>Follow me on Twitter : <a href="https://twitter.com/thevillagehackr">thevillagehacker</a></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/RCE_via_file_upload/" > <div class="nav-arrow">Previous</div> <span class="post-title">RCE via File Upload</span> </a> <a class="post-nav-item post-nav-next" href="/RCE-via-fileupload/"> <div class="nav-arrow">Next</div> <span class="post-title">RCE via File Upload</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="https://github.com/thevillagehacker/"> <img align="center" alt="Naveen's GitHub" width="30px" src="https://img.icons8.com/color/github.png"/></a> <a class="footer_item" href="https://www.linkedin.com/in/thevillagehacker/"> <img align="center" alt="Naveen's LinkedIn" width="30px" src="https://img.icons8.com/color/linkedin.png"/> </a> <a class="footer_item" href="mailto:nvnj1998@gmail.com"> <img align="center" alt="Naveen's E-Mail" width="30px" src="https://img.icons8.com/color/gmail.png" /> </a> <a class="footer_item" href="https://twitter.com/thevillagehackr"> <img align="center" alt="Naveen's twitter" width="30px" src="https://img.icons8.com/color/twitter.png" /> </a><br> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
