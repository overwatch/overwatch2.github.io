<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Naveen J" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Naveen J" /> <title> API Security Misconfiguration Leads to tons of PII data Leakage - Naveen J </title> <link rel="alternate" href="http://localhost:4000/PII-Leak/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/PII-Leak/" /> <meta name="description" content="API Security Misconfiguration Leads to tons of PII data Leakage." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="API Security Misconfiguration Leads to tons of PII data Leakage | Naveen J" /> <meta property="og:title" content="API Security Misconfiguration Leads to tons of PII data Leakage | Naveen J" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/PII-Leak/" /> <meta property="og:description" content="API Security Misconfiguration Leads to tons of PII data Leakage." /> <meta property="og:image" content="" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="API Security Misconfiguration Leads to tons of PII data Leakage | thevillagehackr" /> <meta name="twitter:url" content="http://localhost:4000/PII-Leak/" /> <meta name="twitter:site" content="@thevillagehackr" /> <meta name="twitter:creator" content="@thevillagehackr" /> <meta name="twitter:description" content="API Security Misconfiguration Leads to tons of PII data Leakage." /> <meta name="twitter:image" content="" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Naveen J" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/blog/">Blog</a><a class="menu-link" href="/about/">About</a><a class="menu-link" href="/projects/">Projects</a><!-- <a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a>---> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#pii-leak">PII LEAK</a>, <a class="tag" href="/tags/#misconfiguration">MISCONFIGURATION</a> </span> </div> <h1 class="header-title" itemprop="headline">API Security Misconfiguration Leads to tons of PII data Leakage</h1> <div class="post-meta"> <time datetime="2021-07-01T12:00:00+00:00" itemprop="datePublished"> Jul 01, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Naveen J</span> </span> <time hidden datetime="" itemprop="dateModified"> Jul 01, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">Naveen J</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p><img src="misconfig.webp" alt="img" /></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p><img src="misconfig.webp" alt="img" /></p> <h1 id="what-is-api-misconfiguration"> <a href="#what-is-api-misconfiguration" class="anchor-head"></a> What is API Misconfiguration? </h1> <h2 id="api72019-security-misconfiguration"> <a href="#api72019-security-misconfiguration" class="anchor-head"></a> API7:2019 Security Misconfiguration </h2> <p>Security misconfiguration is commonly a result of insecure default configurations, incomplete or ad-hoc configurations, open cloud storage, misconfigured HTTP headers, unnecessary HTTP methods, permissive Cross-Origin resource sharing (CORS), and verbose error messages containing sensitive information.</p> <h2 id="target-information"> <a href="#target-information" class="anchor-head"></a> Target Information </h2> <p>The target application is similar to uber, ola, and any other transport tracking application. The passengers can track their respective vehicles’ GPS locations to get the route information like ola, uber, and other taxi services.</p> <h2 id="recon"> <a href="#recon" class="anchor-head"></a> Recon </h2> <p>I downloaded and installed the application in the emulator and performed static analysis and reverse engineering using MOBSF, APKtool, jadx -&gt; No luck. The Application having two types of users are users=passengers, administrators.</p> <h2 id="playing-with-proxy"> <a href="#playing-with-proxy" class="anchor-head"></a> Playing with proxy </h2> <p>Started the proxy program (Burp Suite) and clicking all the buttons to find other vulnerabilities in the API. After playing with the proxy I got knowledge about the API that the application is using to access information.</p> <h2 id="api-misconfiguration-in-the-target"> <a href="#api-misconfiguration-in-the-target" class="anchor-head"></a> API Misconfiguration in the target </h2> <p>The Application is using a REST API. The API generates an API key and authorization token at the time of user login actions. I logged in and logged out from the application to observe how the API authorization token works. It seems the API key is default and it will not change and the authorization token changes sometimes and sometimes not. I figured out that the application needs three things to access all the information including administrator access.</p> <h3 id="things-that-api-requires"> <a href="#things-that-api-requires" class="anchor-head"></a> Things that API requires </h3> <ul> <li>API Key</li> <li>Authorization Token</li> </ul> <h3 id="api-key"> <a href="#api-key" class="anchor-head"></a> API Key </h3> <p>We can get the API key at the time of log in the API key never changes from its default value</p> <h2 id="auth-token"> <a href="#auth-token" class="anchor-head"></a> Auth Token </h2> <p>The API does not properly validate the auth token what it validates is that the token is legit or not like in the format the developer created, so all we need is an API-generated token which we can get at the time of login it does not matter whether your credentials are right or wrong.</p> <h3 id="administrator-username"> <a href="#administrator-username" class="anchor-head"></a> Administrator Username </h3> <ul> <li>Username Enumeration</li> <li>Response Manipulation -&gt; change to admin Privileges</li> </ul> <h2 id="response-manipulation"> <a href="#response-manipulation" class="anchor-head"></a> Response Manipulation </h2> <p>Here comes the fun part I created two accounts and tried to take over those accounts using the response manipulation technique. I observe the server responses when I log in as user=passenger and noticed that the JSON body having an object named role and the value is base64 encoded.</p> <p><img src="base64_encode.webp" alt="img" /></p> <p>I quickly changed the role value from user to admin in base64 encoded format and boom I logged in as administrator. There are so many different endpoints present for the administrator account.</p> <h2 id="pii-data-leak"> <a href="#pii-data-leak" class="anchor-head"></a> PII Data Leak </h2> <p>As I stated above to access all those endpoints we need an API key, Auth token, and Administrator username.</p> <p><img src="leak1.webp" alt="img" /></p> <p>Now we have all the three things that the API requires by using all those I accessed all the user=passengers PII data and vehicle information in plain Text in JSON body.</p> <h2 id="taking-over-other-administrator-accounts"> <a href="#taking-over-other-administrator-accounts" class="anchor-head"></a> Taking Over other Administrator Accounts </h2> <p>Since the API is misconfigured we can use the above-shown endpoint to enumerate the administrator usernames.</p> <p><img src="leak2.webp" alt="img" /></p> <p>The endpoint only provides those outputs if the logged-in user is an administrator, the other normal users can’t access that information. So I prepared a bunch of username wordlists and brute-forced them and found more than 4 valid administrator usernames.</p> <p>Then I started sending the requests with that valid username and found different PII data for each of them it seems the separate administrators have different data.</p> <p>After some time I discovered that the API is very poorly configured which means you don’t have to be logged in to the application to access the administrator information. All we have to do to collect and craft a request with API Key, Auth token which we can get at the time of login, and valid username with all of these I can access all of the administrator information.</p> <h2 id="take-aways-"> <a href="#take-aways-" class="anchor-head"></a> Take-Aways:- </h2> <ul> <li>Check for API documentation and collect the authentication and authorization inputs that are required to access data from the API endpoints.</li> <li>Check for API misconfigurations like does the Auth token, API key, and other auth mechanisms are validated properly.</li> <li>Check for Response manipulation attacks.</li> <li>Check for Rate Limiting vulnerability to enumerate Usernames.</li> </ul> <p>Thank you for reading.</p> <p>Follow me on Twitter : <a href="https://twitter.com/thevillagehackr">thevillagehacker</a></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Insecure_Deserialization/" > <div class="nav-arrow">Previous</div> <span class="post-title">Insecure Deserialization</span> </a> <a class="post-nav-item post-nav-next" href="/IDOR/"> <div class="nav-arrow">Next</div> <span class="post-title">IDOR leads to Takeover other user's linked bank accounts</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="https://github.com/thevillagehacker/"> <img align="center" alt="Naveen's GitHub" width="30px" src="https://img.icons8.com/color/github.png"/></a> <a class="footer_item" href="https://www.linkedin.com/in/thevillagehacker/"> <img align="center" alt="Naveen's LinkedIn" width="30px" src="https://img.icons8.com/color/linkedin.png"/> </a> <a class="footer_item" href="mailto:nvnj1998@gmail.com"> <img align="center" alt="Naveen's E-Mail" width="30px" src="https://img.icons8.com/color/gmail.png" /> </a> <a class="footer_item" href="https://twitter.com/thevillagehackr"> <img align="center" alt="Naveen's twitter" width="30px" src="https://img.icons8.com/color/twitter.png" /> </a><br> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
